#include <stdlib.h>
#include <sqlite3.h>
  
#include <stdio.h>
#include <string.h>
#include <assert.h>
#include <zlib.h>

#if defined(MSDOS) || defined(OS2) || defined(WIN32) || defined(__CYGWIN__)
#  include <fcntl.h>
#  include <io.h>
#  define SET_BINARY_MODE(file) setmode(fileno(file), O_BINARY)
#else
#  define SET_BINARY_MODE(file)
#endif

#define CHUNK 16384

char* portal_data_z =   "\x78\xda\xed\x9c\x3d\x4e\xc3\x40\x10\x46\xe7\x06\xd0\x50\xd0\x71\x14\x97\xe9\x52\x53\x52\x52\x52\x44"
"\xa2\x42\xdb\x51\x46\x39\x00\xa7\xe0\x04\x5c\x81\x1b\x70\x03\x2e\x80\xc2\x28\x1b\xad\x46\xbb\xb6\xe3\x9f\x24\x30\x9b\xf7\xf4"
"\xc5\x9a\xb5\xbd\x6b\x2b\xd2\xb3\x93\xd8\xf1\x8d\x88\x5c\xeb\xeb\x56\x60\xc7\x6a\x24\x73\xfa\xda\x11\x56\x33\x38\x67\xf7\x10"
"\xc2\x11\xf7\xff\x58\xef\x3c\xc0\x45\x1d\x2e\x62\xf7\xf5\xdd\x76\x54\xb2\xee\x08\x0b\x70\x4e\xc2\x8e\x69\x6b\x6a\x73\xac\xef"
"\xe5\x08\x93\xb7\x0e\x00\x13\x7c\x9f\xbc\xb2\x36\x5f\xaf\xb6\x31\x8d\x84\x83\x85\xa6\x1c\xe1\x44\xbb\x0a\x00\xa7\xf3\x5d\xb3"
"\x90\x4d\x9a\x96\x4d\x4d\xeb\x08\xf8\x0e\xe0\xc5\xf7\x17\xf9\x19\x1e\x7c\x07\xa8\xc3\xf7\xa5\xbc\x75\x05\xdf\x01\xea\xf0\xfd"
"\x59\xbe\x0f\x46\x95\x8f\x05\xbe\x03\x54\xe3\xfb\xbd\xbc\x67\xb1\x8b\xf0\x1d\xc0\xbb\xef\x4f\xf2\x15\xa3\x46\xa7\xba\x9c\x19"
"\x0b\x7c\x07\xa8\xc0\xf7\x07\xf9\x48\x8e\x6b\x9d\x35\xd3\x14\xdf\x01\x5c\xfb\xae\xd3\x47\xf9\x54\x9d\x75\xda\x53\xa4\x26\xbe"
"\x03\x78\xf7\x7d\x78\xf0\x1d\xc0\xaf\xef\xf1\xd3\xbb\x3d\x8f\xdb\x33\x7b\xb9\x08\xdf\x01\xbc\xfb\x6e\xbf\xa7\x67\xc9\x16\xe1"
"\x3b\x80\x5f\xdf\xe3\x75\xb7\xf8\x0b\xbc\x2d\xba\xe6\xe3\x3b\x80\x77\xdf\xed\xc5\xf7\xd6\x2b\xf2\xa9\xc6\x77\x00\xbf\xbe\xa7"
"\x9b\x66\xe3\x7d\x74\xad\xb1\x8b\xf0\x1d\xa0\x02\xdf\xed\x7d\xf2\x59\xec\x3a\xf8\x0e\xe0\xd7\xf7\x85\x6c\x46\x05\xdf\x01\xea"
"\xf0\xdd\xfe\xe7\xbd\x6c\xe2\x3b\x80\x77\xdf\x1b\xd9\x27\x3e\xc7\xa6\xbf\x68\x24\xe0\x3b\xc0\xdf\xfa\x3e\xe7\xf9\x75\x49\xe4"
"\x81\xe1\xf9\x75\x00\xff\x41\xf9\x21\x74\xf5\x1d\x68\x7a\xcf\x08\xd3\xb6\x0e\x00\x8e\x0e\x17\x70\x51\xfc\x02\x30\x0b\xc7\x12";

int z_len = 445;
int u_len = 25212;

#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>

static int callback(void *NotUsed, int argc, char **argv, char **azColName){
    int i;
    for(i=0; i<argc; i++){
      printf("%s = %s\n", azColName[i], argv[i] ? argv[i] : "NULL");
    }
    printf("\n");
    return 0;
}
  
int main(int argc, char **argv){
    char* portal_data = (char*)malloc(u_len);
    unsigned long len = u_len;
    int error = uncompress(portal_data, &len, portal_data_z, z_len);

    printf("Inflated portal skin from %d bytes to %lu bytes \n", z_len, len);

    sqlite3 *db;
    char *zErrMsg = 0;
    int rc;

    rc = sqlite3_open("data1.db", &db);
    if( rc ){
      fprintf(stderr, "Can't open database: %s\n", sqlite3_errmsg(db));
      sqlite3_close(db);
      return(1);
    }

    sqlite3_stmt *preparedStatement;
    sqlite3_prepare_v2(db, "UPDATE blobs SET value=? WHERE key=?", (int)strlen("UPDATE blobs SET value=? WHERE key=?"), &preparedStatement, 0);
    sqlite3_bind_blob(preparedStatement, 1, portal_data, len, 0);
    sqlite3_bind_text(preparedStatement, 2, "market-stand0.cub", (int)strlen("market-stand0.cub"), NULL);
    sqlite3_step(preparedStatement);
    sqlite3_bind_text(preparedStatement, 2, "market-stand1.cub", (int)strlen("market-stand0.cub"), NULL);
    sqlite3_step(preparedStatement);
    sqlite3_bind_text(preparedStatement, 2, "market-stand2.cub", (int)strlen("market-stand0.cub"), NULL);
    sqlite3_step(preparedStatement);
    sqlite3_bind_text(preparedStatement, 2, "market-stand3.cub", (int)strlen("market-stand0.cub"), NULL);
    sqlite3_step(preparedStatement);

    sqlite3_close(db);
    return 0;
}
